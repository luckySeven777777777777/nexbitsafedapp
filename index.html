<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Connect Wallet</title>

  <style>
    #connectButton {
      padding: 12px 24px;
      background-color: #f6851b;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }
    #walletStatus {
      margin-top: 12px;
      font-size: 14px;
    }
  </style>
</head>

<body>

  <button id="connectButton">Connect Wallet</button>
  <div id="walletStatus">Not connected</div>

  <script>
    const btn = document.getElementById("connectButton");
    const info = document.getElementById("walletStatus");

    // æ£€æŸ¥ MetaMask
    if (typeof window.ethereum === "undefined") {
      info.innerText = "âŒ MetaMask not detected";
    }

    btn.onclick = async () => {
      if (window.ethereum) {
        try {
          // è¿æ¥ MetaMask
          const accounts = await window.ethereum.request({
            method: "eth_requestAccounts"
          });

          info.innerText = "âœ… Connected: " + accounts[0];

          // ç›‘å¬è´¦æˆ·åˆ‡æ¢
          window.ethereum.on("accountsChanged", (accounts) => {
            info.innerText = "ğŸ”„ Switched: " + accounts[0];
          });

        } catch (err) {
          info.innerText = "âŒ User rejected connection";
        }
      } else {
        // å¦‚æœæ²¡æœ‰ MetaMaskï¼Œä½¿ç”¨ WalletConnect è¿æ¥
        const projectId = "257aebada0de0efef7d425e84b57ebfe";  // è¯·æ›¿æ¢ä¸ºä½ è‡ªå·±çš„ Project ID
        const WCProvider = window.WalletConnectEthereumProvider.default;
        let wcProvider;

        try {
          // åˆå§‹åŒ– WalletConnect Provider
          wcProvider = await WCProvider.init({
            projectId,
            chains: [1, 56],  // æ”¯æŒ Ethereum å’Œ BSC
            showQrModal: true,  // æ˜¾ç¤º WalletConnect æ‰«ç å¼¹çª—
            methods: ["eth_sendTransaction", "personal_sign"],
            events: ["accountsChanged", "chainChanged"],
            metadata: {
              name: "NEXBITSAFE",
              description: "Connect to NEXBITSAFE",
              url: window.location.origin,
              icons: []
            }
          });

          // è¿æ¥é’±åŒ…
          await wcProvider.connect();

          // è·å–è¿æ¥çš„è´¦æˆ·åœ°å€
          const accounts = wcProvider.accounts;
          info.innerText = "âœ… Connected: " + accounts[0];

        } catch (err) {
          console.error(err);
          info.innerText = "âŒ WalletConnect connection failed";
        }
      }
    };
  </script>

</body>
</html>
